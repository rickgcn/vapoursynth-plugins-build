name: bestsource
package: bestsource
type: plugin
description: A super great audio/video source and FFmpeg wrapper
repository: https://github.com/vapoursynth/bestsource.git
license: MIT
env:
  darwin-x86_64:
    CFLAGS: "-mmacosx-version-min=10.11 -mmacos-version-min=10.11"
    CXXFLAGS: "-mmacosx-version-min=10.11 -mmacos-version-min=10.11"
  darwin-aarch64:
    CFLAGS: "-mmacosx-version-min=11.0 -mmacos-version-min=11.0"
    CXXFLAGS: "-mmacosx-version-min=11.0 -mmacos-version-min=11.0"
  darwin-.*:
    CFLAGS: "-O3 -fPIC"
    CXXFLAGS: "-O3 -fPIC"
  linux-.*:
    CFLAGS: "-O3 -fPIC"
    CXXFLAGS: "-O3 -fPIC"
releases:
  - version: "R14"
    type: git
    source: https://github.com/vapoursynth/bestsource.git
    tag: "R14"
    dependencies:
      "(linux|darwin)-.*":
        - name: vapoursynth
          version: "R72"
        - name: dav1d
          version: 1.5.2
        - name: ffmpeg
          version: "7.1.2-with-Little-CMS"
        - name: xxHash
          version: 0.8.3
    build:
      darwin-.*:
        commands:
          - cwd: "{WORKDIR}/bestsource"
            cmd: git submodule update --init --recursive
          - cmd: meson setup build --prefix={PREFIXDIR} --buildtype=release
          - cmd: ninja -C build
          - cmd: sudo ninja -C build install
      linux-.*:
        env:
          LDFLAGS: "-Wl,-Bsymbolic"
        commands:
          - cwd: "{WORKDIR}/bestsource"
            cmd: git submodule update --init --recursive
          - cmd: meson setup build --prefix={PREFIXDIR} --buildtype=release
          - cmd: ninja -C build
          - cmd: sudo ninja -C build install
    artifacts:
      linux-.*:
        - "{PREFIXDIR}/lib/x86_64-linux-gnu/libbestsource.so"
      darwin-.*:
        - "{PREFIXDIR}/lib/libbestsource.dylib"
tests:
  - name: av1-test
    attachments:
      - av1-test.vpy
      - av1-test.mkv
    commands:
      - cwd: "{TESTDIR}"
        cmd: vspipe av1-test.vpy --
  - name: h264-test
    attachments:
      - h264-test.vpy
      - h264-test.mkv
    commands:
      - cwd: "{TESTDIR}"
        cmd: vspipe h264-test.vpy --
  - name: hevc-test
    attachments:
      - hevc-test.vpy
      - hevc-test.mkv
    commands:
      - cwd: "{TESTDIR}"
        cmd: vspipe hevc-test.vpy --
attachments:
  av1-test.vpy:
    path: "{TESTDIR}"
    encoding: text/utf-8
    data: |
      import vapoursynth as vs
      core = vs.core
      core.std.LoadPlugin('{PLUGIN_PATH}')
      clip = core.bs.VideoSource('av1-test.mkv', cachemode=0)
      clip.set_output(0)
  av1-test.mkv:
    path: "{TESTDIR}"
    encoding: base64/zstd
    data: KLUv/WTtBYUdACQyGkXfo6NChoEBQveBAULygQRC84EIQoKIbWF0cm9za2FCh4EEQoWBAhhTgGcBAAa5EU2bdMC/hA/5EltNu4tTq4QVSalmU6yBoRZUrmtTrIHvTbuMU6uEElTDZ1OsggNNHFO7a1Osggad7ABTAMm/hPu8NCMq17GDD0JATYCMTGF2ZjYyLjMuMTAwV0FzpJAK8Dth4WruwiB0ZL0UcX+SRImIQI9IQli/hNoN1tWuAknXgQFzxYgS8h4KFFmA/ZyBACK1nIN1bmSIgQCGhVZfQVYxg4EBI+ODhAJ8ay3gmrCCB4C6ggQ4moECVbCMVbmBAVW3gQJVuIECVe6BAAIAAGOikYEIDAAKCwAAAEKrv8NzK+QBAdRAhb+E6QL7DnNzn2PAgGfImUWjh0VOQ09ERVJEh3PaY8CLY2fIpZhMYXZjNjIuMTEgbGliYW9tLWF2MWfIoUWjiERVUkFUSU9ORIeTMDA6MS4wMDEwAB9DtnVCv7+ETtsjnueBAKO8gQAAgDIpEACK4AAAkAAAA84LbTB2fDSIgj4NPsKYkX5kHKrPW86x5UKnHQk/IhCjp4EAKgAyITADwIAAAEaLQAgAmSOqr63uokvvZMsSGEAdInDwo5mBAFMAMhMwBAEEgOwfdsx9BgIIgABGi+DjTiHgpwgEDRAARowAAADYKSpAo5iBANEAMhIwCggRoEBGjCDUE0z6DBAWMIhGjEDNvTyjmIEBJA4gGsDRRoyAyJuUThAAn1EaRozAxDr4dxIBB+FjRo0AwJp4oRQCCPGsRo1gvevoyxYEDRH1Ro3Au+Rw9RgIEaB+Ro4Aut2wo5iBAh4aEBYwj0aOgDlwSByPALlVEHIej2C5etCjqIECmwAyIjAhwQfhYwaZAAAAsAAAAJ0KXUTv3W7KBGh/OT2QBSiTeezFIgIH5CwGkGAAAKAAAAC6K2DvJAQM9DUGkSCH4KOYgQMYJggRlD4GkeC7QWBCKBAWNA8GksC8CWwqIBrEGQaUAL2B4JYsAJ9UIwaVwL9CoL8uwHogHFO7a5e/hOVpsKG7j7OBALeK94EB8YID2PCBCVKoQTxFjcAQTiZOEm2aA1CDhJnoEoCoqDbBhKHl/3+aA0kOn3ZWH4gdQD8a5lLXHoZ7hMbOmXWTVnORHsskh7UZ1J2X1BjgpU0/6ZXszd0XgKGUMxZKo1QStpZPdUkb4tv7pL1qlWfkeQGCBs6ywYoYn8/DXuUIpvVVx0pflJ+QzsOa0beLIg+R2+8PSmRPWA==
  h264-test.vpy:
    path: "{TESTDIR}"
    encoding: text/utf-8
    data: |
      import vapoursynth as vs
      core = vs.core
      core.std.LoadPlugin('{PLUGIN_PATH}')
      clip = core.bs.VideoSource('h264-test.mkv', cachemode=0)
      clip.set_output(0)
  h264-test.mkv:
    path: "{TESTDIR}"
    encoding: base64/zstd
    data: KLUv/WQbDe0pALpKTBFHcGpxA0X2q2wRtVRPvz0tu8tVoaKire//V+eJLP1ONwQkdLe/u6RHSDpFkhMo7R5n2c5PwKjnroJtkxu6mmF211iMKglR5A4ZAQEB4ABlkwKlDA9lWUJEF5oNZ1TuJ96ilSxQQmnmi1ay5pEea1me5X/DdP4mTOdnwmR+J0wxjDCdH2vop/hkSkDRCFaZmFDFaaQ6g8H8VEQndDOl3tGsFoJXAkk9YdWi/EfWdaLaoeRC+XcYYKAkByTpy86Rimx+L1dFFvDQwsaY/JEzssodXRSp0ON2caMNEGcUWMvoSQtShg9Zh2JvVEaTpbffUycRYwopt0NAdcQLrOhEzNCYtFL2yjZXDhS3ekKu3gQss7jVA0pZWmAc0ovBhQTnb/WERZYcaP2t3k/IUQPjkB4MLqQqqxwbjMmuWQeSAjUHShM41QM6P4vdz6/adaH8xnMnHou7AZ/O7ufP2Zn/zs78LXZIJBlehLSozb0sNexu1xu3cSgXru/Q51l9Q/nPxxrla/f1VeNk921n+NUxPSTOQdkMGL8ytw9fz7ZPMigoqNkMB89zUMe0Ld1pjLZ3quefH0rBL5GO6dWz76qJTuh0LTar3VKZkY7pbts3G82n0zSlxdp2Q7WP31XHNJw3GMDoL0JXTIzApIHChjeGyNcXgABHzrKcKsvvpghZfjV1dBTYYkwiRzgtIapQbnRvGYrbm0ZVUZLS0ZLOBFPREcnT8gLWbmmUrx1qFJWlt/Wpk7DRwwu4wuhavchVRSZ4RUpESbwqJC+HF3Cqa+Uhy0auILgyJou5Eg8ePUJIanyiNUEBpQkCiEpOq6xpKXdborptKZ/dVsoLdcrhzeEXqLoefjXKfXMQ2HooTePz6uNW7q1vhjvbVZ9OOdsSeywFqz49xGVP7PGvx7Pbqqx32x7PsvuuevO5w8R3VaV67DT06c1Zv/Zh7Ge31Sj3cye2a+zq7dd2KOtUZbsPduH7DrUN5TLbfRycdRrjs5d/v1eFm+BWKMPqLPefRlEhNOXefVOw3bN6c2LTqlE+r+xQ1JBOudwOhz6etdqJbxxcdS3lHuj2WPVErbI+qiXqvWUbx9lYRbmUDOuNck/0Ock6SHTinqhpNDRq4wIEfpwLZ1GO+e+8YFL+JFZcTgWWXBmTN4KwXMFmXbaGQTCCsLgsE8hBhSPGNEu38/leSCjmAxNHyiXMeSphA8PShUj6/C3IICEqBmA6YG3iGViMThZ1gvwVmM+sB49Dlql1+mCY8sNCli5H4fxeyJmJI+VynrajCFg6HpzzZzkAIQnmJoOZJY8RES6/FUEgerDkUQNQlgnz8bFKUJUgS/cBSPmrIAWYX0rHGAEsXQ7K/F5Imjm1YM+Zs0pA09qnLHEs7UlyUfj6Kf/RbxzKm7reNRnK33busQq3usZhP8twk+5w41EdbtL7Jtu8SW8ZauO/2Pt49hH1L175jatrrDcPyj7u8a7x2Wn1rg9uqFFIaoxAKSIjEkggIiKaPNCCmREizgESQBYZRyRKQAgR//+9NgeSDZiF44a+w2GrwWwWzlgZwwkceC9dg7CQGp/MdVBxNJrlWLikUsmJP9xRoA8pJfO7yniT23pah3OEtzUIZiLD2NRxItg4c6LoeElw8A+j1M9Ak7641pJ01ydWjh2oyl06zUVSHvCquypV0+kBhB0dACqWO86PjgY6DOHbCeaa4lO+N7p2KTBglVScrq8r40EbEyvgkDe/9KBPVULP6TU6uILCMn5UOcypcq2Dr7NcmQQgPKRVNPOUM/zxaflMA6jNL8U=
  hevc-test.vpy:
    path: "{TESTDIR}"
    encoding: text/utf-8
    data: |
      import vapoursynth as vs
      core = vs.core
      core.std.LoadPlugin('{PLUGIN_PATH}')
      clip = core.bs.VideoSource('hevc-test.mkv', cachemode=0)
      clip.set_output(0)
  hevc-test.mkv:
    path: "{TESTDIR}"
    encoding: base64/zstd
    data: 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