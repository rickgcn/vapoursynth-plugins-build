# Shared dependencies for VapourSynth plugins
# This file contains common dependencies that can be used by multiple plugins

dependencies:
  zimg:
    repository: https://github.com/sekrit-twc/zimg.git
    license: WTFPL
    versions:
      "3.0.6":
        type: tarball
        source: https://github.com/sekrit-twc/zimg/archive/refs/tags/release-3.0.6.tar.gz
        hash: sha256sum:be89390f13a5c9b2388ce0f44a5e89364a20c1c57ce46d382b1fcc3967057577
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/zimg-release-3.0.6"
                cmd: ./autogen.sh
              - cmd: ./configure --prefix={PREFIXDIR}
              - cmd: make -j${NPROC}
              - cmd: sudo make install
          "linux-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/zimg-release-3.0.6"
                cmd: ./autogen.sh
              - cmd: ./configure --prefix={PREFIXDIR} --host={TARGET_TRIPLET}
              - cmd: make -j${NPROC}
              - cmd: make install

  vapoursynth:
    repository: https://github.com/vapoursynth/vapoursynth.git
    license: LGPL-2.1
    versions:
      "R72":
        type: tarball
        source: https://github.com/vapoursynth/vapoursynth/archive/refs/tags/R72.tar.gz
        hash: sha256sum:650f77feebfd08842b521273f59e0c88f7ba9d7cb5f151d89b79b8dfdd4ce633
        dependencies:
          "(linux|darwin)-.*":
            - name: zimg
              version: "3.0.6"
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/vapoursynth-R72"
                cmd: ./autogen.sh
              - cmd: ./configure --prefix={PREFIXDIR} --disable-x86-asm --disable-vsscript --disable-vspipe --disable-python-module
              - cmd: make -j${NPROC}
              - cmd: sudo make install
          "linux-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/vapoursynth-R72"
                cmd: ./autogen.sh
              - cmd: ./configure --prefix={PREFIXDIR} --disable-x86-asm --disable-vsscript --disable-vspipe --disable-python-module --host={TARGET_TRIPLET}
              - cmd: make -j${NPROC}
              - cmd: make install

  xxHash:
    repository: https://github.com/Cyan4973/xxHash.git
    license: BSD-2-Clause
    versions:
      "0.8.3":
        type: tarball
        source: https://github.com/Cyan4973/xxHash/archive/refs/tags/v0.8.3.tar.gz
        hash: sha256sum:aae608dfe8213dfd05d909a57718ef82f30722c392344583d3f39050c7f29a80
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/xxHash-0.8.3"
                cmd: make libxxhash.a libxxhash.pc
              - cmd: sudo make install_libxxhash.a install_libxxhash.includes install_libxxhash.pc
          "linux-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/xxHash-0.8.3"
                cmd: make libxxhash.a libxxhash.pc
              - cmd: make install_libxxhash.a install_libxxhash.includes install_libxxhash.pc DESTDIR={SYSROOT}

  Little-CMS:
    repository: https://github.com/mm2/Little-CMS.git
    license: MIT
    versions:
      "2.17":
        type: tarball
        source: https://github.com/mm2/Little-CMS/archive/refs/tags/lcms2.17.tar.gz
        hash: sha256sum:6e6f6411db50e85ae8ff7777f01b2da0614aac13b7b9fcbea66dc56a1bc71418
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/Little-CMS-lcms2.17"
                cmd: ./autogen.sh
              - cmd: ./configure --prefix={PREFIXDIR}
              - cmd: make -j{NPROC}
              - cmd: sudo make install
          "linux-x86_64-musl":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/Little-CMS-lcms2.17"
                cmd: ./autogen.sh --host={TARGET_TRIPLET}
              - cmd: ./configure --prefix={PREFIXDIR} --host={TARGET_TRIPLET} --enable-static --disable-shared
              - cmd: make -j{NPROC}
              - cmd: make install
          "linux-x86_64-glibc":
            env:
              LDFLAGS: "-Wl,-Bstatic -lm"
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/Little-CMS-lcms2.17"
                cmd: ./autogen.sh --host={TARGET_TRIPLET}
              - cmd: ./configure --prefix={PREFIXDIR} --host={TARGET_TRIPLET} --enable-static --disable-shared
              - cmd: make V=1 -j{NPROC}
              - cmd: make install

  zlib:
    repository: https://github.com/madler/zlib.git
    license: MIT
    versions:
      "1.3.1":
        type: tarball
        source: https://github.com/madler/zlib/releases/download/v1.3.1/zlib-1.3.1.tar.gz
        hash: sha256sum:9a93b2b7dfdac77ceba5a558a580e74667dd6fede4585b91eefb60f03b72df23
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/zlib-1.3.1"
                cmd: ./configure --static --prefix={PREFIXDIR}
              - cmd: make -j{NPROC}
              - cmd: sudo make install
          "linux-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/zlib-1.3.1"
                cmd: ./configure --static --prefix={PREFIXDIR}
              - cmd: make -j{NPROC}
              - cmd: make install

  dav1d:
    repository: https://code.videolan.org/videolan/dav1d.git
    license: BSD-2-Clause
    versions:
      "1.5.2":
        type: tarball
        source: https://code.videolan.org/videolan/dav1d/-/archive/1.5.2/dav1d-1.5.2.tar.gz
        hash: sha256sum:2fc0810b4cdf72784b3c107827ff10b1d83ec709a1ec1fbdbc6a932daf65ead6
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/dav1d-1.5.2"
                cmd: meson setup build --prefix={PREFIXDIR} --buildtype=release --default-library=static
              - cmd: ninja -C build
              - cmd: sudo ninja -C build install
          "linux-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/dav1d-1.5.2"
                cmd: meson setup build --prefix={PREFIXDIR} --buildtype=release --default-library=static --cross-file {MESON_CROSS_FILE}
              - cmd: ninja -C build
              - cmd: ninja -C build install

  ffmpeg:
    repository: https://git.ffmpeg.org/ffmpeg.git
    license: LGPL-2.1-or-later
    versions:
      "6.1.3":
        type: tarball
        source: https://ffmpeg.org/releases/ffmpeg-6.1.3.tar.gz
        hash: sha256sum:3be466dfd1a312d752c20ece5b413248a5808fba3c967da0624bac48a4380857
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/ffmpeg-6.1.3"
                cmd: ./configure --prefix={PREFIXDIR} --enable-gpl --enable-version3 --disable-programs --disable-doc --enable-static --disable-shared --enable-pic --disable-encoders --enable-libdav1d --disable-muxers --disable-debug
              - cmd: make -j{NPROC}
              - cmd: make install
          "linux-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/ffmpeg-6.1.3"
                cmd: ./configure --prefix={PREFIXDIR} --enable-gpl --enable-version3 --disable-programs --disable-doc --enable-static --disable-shared --enable-pic --disable-encoders --enable-libdav1d --disable-muxers --disable-debug --enable-cross-compile --cross-prefix={TARGET_TRIPLET}- --target-os=linux --arch=x86_64
              - cmd: make -j{NPROC}
              - cmd: make install
      "7.1.2-with-Little-CMS":
        type: tarball
        source: https://ffmpeg.org/releases/ffmpeg-7.1.2.tar.gz
        hash: sha256sum:eea81393e530fdd5cf55ac12820f057d20fa681ae61864c46bb3831091d3d8e1
        dependencies:
          "(linux|darwin)-.*":
            - name: Little-CMS
              version: "2.17"
        build:
          "darwin-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/ffmpeg-7.1.2"
                cmd: ./configure --prefix={PREFIXDIR} --enable-gpl --enable-version3 --disable-programs --disable-doc --enable-static --disable-shared --enable-pic --disable-encoders --enable-libdav1d --enable-lcms2 --disable-muxers --disable-debug
              - cmd: make -j{NPROC}
              - cmd: sudo make install
          "linux-.*":
            commands:
              - cwd: "{WORKDIR}"
                cmd: tar xf {DL_FILE_NAME}
              - cwd: "{WORKDIR}/ffmpeg-7.1.2"
                cmd: ./configure --prefix={PREFIXDIR} --enable-gpl --enable-version3 --disable-programs --disable-doc --enable-static --disable-shared --enable-pic --disable-encoders --enable-libdav1d --enable-lcms2 --disable-muxers --disable-debug --enable-cross-compile --cross-prefix={TARGET_TRIPLET}- --target-os=linux --arch=x86_64
              - cmd: make -j{NPROC}
              - cmd: make install
